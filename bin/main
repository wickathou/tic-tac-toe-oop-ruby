#!/usr/bin/env ruby

require 'tty-prompt'

require_relative '../lib/decision_maker'

# GAME CLASS
class Game
  def initialize
    greeting
    new_game
  end

  def new_game
    start_decision_maker
    user_input
    restart
  end

  def greeting
    puts 'Tic Tac Toe: two rivals, two symbols, only one chance to win...'
  end

  def start_decision_maker
    puts 'Please Select, Would you like to be Player ❌ or Player 🔵?'
    @decision_maker = DecisionMaker.new
    puts @decision_maker.response_message
    board_printer
  end

  def user_input
    until @decision_maker.winner || @decision_maker.moves.empty?
      new_move
      board_printer
      next_player
    end
  end

  def new_move
    @decision_maker.move_get
    puts @decision_maker.response_message
  end

  def next_player
    @decision_maker.move_sequence
    puts @decision_maker.response_message
  end

  def board_printer
    @decision_maker.print_board
    puts @decision_maker.response_message
  end

  def restart
    prompt = TTY::Prompt.new
    new_game if prompt.yes?('Play again?') do |ans|
      ans.default false
    end
  end
end

Game.new
